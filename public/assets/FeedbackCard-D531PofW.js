import{r as c,j as e,p as I,q as v,h as j,s as D,t as U,v as C,w,x as b,y as S,z as y,g as m,A,B as O,C as M,D as N,E as P}from"./index-Ca3VZLAD.js";import{a as _,b as $,e as q}from"./index-BGDHnJBc.js";const k=[{value:"bug",label:"Bug反馈",description:"Bug 反馈"},{value:"feature",label:"新功能",description:"希望新增什么功能"},{value:"suggestion",label:"建议",description:"对产品的建议便于改良"}];function G(i){var t;return((t=k.find(n=>n.value===i))==null?void 0:t.label)||i}const Y=({onSubmit:i})=>{const[r,t]=c.useState("bug"),[n,d]=c.useState(""),[l,g]=c.useState([]),[h,f]=c.useState(!1),[T,o]=c.useState(!1),[R,x]=c.useState(""),B=s=>{const a=s.target.files;if(a){if(l.length+a.length>5){x("图片最多5张"),o(!0);return}Array.from(a).forEach(u=>{if(u.size>5*1024*1024){x("图片大小不能超过5MB"),o(!0);return}const p=new FileReader;p.onload=()=>{g(L=>[...L,u])},p.readAsDataURL(u)}),s.target.value=""}},F=s=>{g(a=>a.filter((u,p)=>p!==s))},E=async()=>{if(!n.trim()){x("请输入反馈内容"),o(!0);return}f(!0);try{await i(n.trim(),r,l),x("反馈成功"),o(!0),t("bug"),d(""),g([])}catch(s){x("反馈失败"),o(!0)}finally{f(!1)}},z=r&&n.trim()&&!h;return e.jsxs("div",{className:"feedback-form",children:[e.jsx(I,{children:e.jsxs(v,{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"5px"},children:[e.jsx(j,{children:e.jsx("strong",{children:"反馈类型"})}),e.jsx(D,{style:{width:"auto"},interface:"action-sheet",placeholder:"请选择反馈类型",value:r,onIonChange:s=>t(s.detail.value),children:k.map(s=>e.jsx(U,{value:s.value,children:s.label},s.value))})]}),e.jsxs("div",{style:{marginBottom:"10px"},children:[e.jsx(j,{children:e.jsxs("strong",{children:["图片 (",l.length,"/5)"]})}),e.jsx(C,{style:{marginTop:"6px"},children:e.jsxs(w,{children:[l.map((s,a)=>e.jsx(b,{size:"4",children:e.jsxs("div",{style:{position:"relative"},children:[e.jsx(S,{src:URL.createObjectURL(s),alt:"图片 ".concat(a+1),style:{width:"100%",height:"100px",objectFit:"cover",borderRadius:"8px"}}),e.jsx(y,{fill:"clear",size:"small",style:{position:"absolute",top:"4px",right:"4px","--border-radius":"50%","--background":"rgba(0,0,0,0.6)",width:"32px",height:"32px"},onClick:()=>F(a),children:e.jsx(m,{icon:_,style:{color:"white"}})})]})},a)),l.length<5&&e.jsx(b,{size:"4",children:e.jsx("div",{onClick:()=>{var s;return(s=document.getElementById("image-upload"))==null?void 0:s.click()},style:{width:"100%",height:"100px",border:"2px dashed #ccc",borderRadius:"8px",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",backgroundColor:"#f8f9fa"},children:e.jsx(m,{icon:$,style:{fontSize:"32px",color:"#999"}})})})]})})]}),e.jsxs("div",{style:{marginTop:"10px"},children:[e.jsx(j,{children:e.jsx("strong",{children:"反馈内容"})}),e.jsx(A,{placeholder:"请输入反馈内容",value:n,onIonInput:s=>d(s.detail.value),rows:3,maxlength:500,counter:!0,fill:"outline"})]}),e.jsx("input",{type:"file",accept:"image/*",multiple:!0,onChange:B,style:{display:"none"},id:"image-upload",disabled:l.length>=5}),e.jsx("div",{style:{marginTop:"5px"},children:e.jsx(y,{expand:"block",onClick:E,disabled:!z||h,fill:h?"outline":"solid",children:h?e.jsx(O,{type:"indeterminate",style:{marginRight:"8px"}}):e.jsxs(e.Fragment,{children:[e.jsx(m,{icon:q,slot:"start"}),"提交"]})})})]})}),e.jsx(M,{isOpen:T,onDidDismiss:()=>o(!1),message:R,duration:3e3,position:"top"})]})},J=({type:i,description:r,images:t})=>e.jsx("div",{className:"feedback-form",children:e.jsxs(I,{color:"warning",children:[e.jsx(N,{children:e.jsx(P,{children:G(i)})}),e.jsxs(v,{children:[t&&t.length>0&&e.jsx("div",{style:{marginBottom:"10px"},children:e.jsx(C,{style:{marginTop:"6px"},children:e.jsx(w,{children:t.map((n,d)=>e.jsx(b,{size:"4",children:e.jsx("div",{style:{position:"relative"},children:e.jsx(S,{src:URL.createObjectURL(n),alt:"图片 ".concat(d+1),style:{width:"100%",height:"100px",objectFit:"cover",borderRadius:"8px"}})})},d))})})}),e.jsx("div",{style:{marginTop:"10px"},children:r})]})]})});export{Y as F,J as a};
